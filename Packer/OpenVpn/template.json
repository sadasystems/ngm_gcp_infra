{

  "variables": {
    "env_user": "{{env `USER`}}",
    "project_id": "{{env `TF_VAR_project_id`}}",
    "zone": "{{env `TF_VAR_zone`}}"
  },
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "{{user `project_id`}}",
      "source_image_family": "centos-7",
      "ssh_username": "packer",
      "zone": "{{user `zone`}}",
      "image_name": "mgmt-openvpn-image-{{isotime \"2006-01-02 03_04_05\" | clean_image_name }}",
      "image_description": "An OpenVPN server.",
      "image_family": "mgmt-openvpn-centos-7",
      "omit_external_ip": false
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "execute_command": "{{.Vars}} sudo -E -S bash '{{.Path}}'",
      "inline": [
        "yum install -y wget jq "
      ]
    },
    {
      "type": "file",
      "source": "Files/openvpn-install.sh",
      "destination": "/tmp/openvpn-install.sh"
    },
    {
      "type": "shell",
      "execute_command": "{{.Vars}} sudo -E -S bash '{{.Path}}'",
      "inline": [
        "cp /tmp/openvpn-install.sh /usr/local/bin/openvpn-install.sh"
      ]
    }
  ]
}
